import{z as h}from"./index-ad467eb3.js";import{S as n}from"./sweetalert2.all-dc3da75e.js";import{z as d,A as u,B as i,C as l,D as C}from"./apis-9024af3e.js";function e(t){let r=t.toString();return r=r.replace(/\B(?=(\d{3})+(?!\d))/g,","),r}const y=h("cartStore",{state:()=>({cartList:[],cartLength:0,saveMoney:0,productCount:0,toastContent:{},isLoading:!1}),getters:{getCartSort:t=>{t.sort(r=>a.price-b.price)}},actions:{showToast(t){n.mixin({toast:!0,position:"top",showConfirmButton:!1,timer:2500,timerProgressBar:!0,...t}).fire()},showAlert(t){return n.fire({confirmButtonText:"確定",cancelButtonText:"取消",...t})},getCart(){d().then(t=>{this.cartList=t.data.data,this.cartList.carts.forEach(r=>{r.final_total=e(r.final_total),r.total=e(r.total)}),this.cartList.final_total=Math.round(this.cartList.final_total),this.cartLength=t.data.data.carts.length,this.saveMoney=Math.round(t.data.data.total-t.data.data.final_total),this.saveMoney=e(this.saveMoney),this.cartList.final_total=e(this.cartList.final_total),this.cartList.total=e(this.cartList.total)}).catch(t=>{console.error(t)})},deleteCart(t){u(t).then(r=>{this.getCart()}).catch(r=>{console.error(r)})},editCart(t,r){this.productCount=t.qty,r?this.productCount++:this.productCount>0&&this.productCount--;const o={data:{product_id:t.product_id,qty:this.productCount}};i(t.id,o).then(s=>{t.qty=this.productCount,t.qty===0&&this.showAlert({title:"確定要移除該商品嗎？",showCancelButton:!0,icon:"info"}).then(c=>{c.isConfirmed&&(this.deleteCart(t.id),this.getCart())}),this.getCart()}).catch(s=>{console.error(s)})},changeCartNum(t){if(this.productCount=t.qty,!Number(t.qty)&&t.qty!==0){this.showToast({title:"數量必須為數字",icon:"error"}),t.qty=1;return}if(t.qty<0){t.qty=1,this.productCount=t.qty;let o={data:{product_id:t.product_id,qty:this.productCount}};i(t.id,o).then(s=>{this.getCart()});return}else if(t.qty===0){this.showAlert({title:"確定要移除該商品嗎？",showDenyButton:!0,icon:"info",denyButtonText:"保留"}).then(o=>{if(o.isConfirmed){this.deleteCart(t.id),this.getCart();return}else o.isDenied&&(t.qty=1)}).catch(o=>{console.error(o)});return}let r={data:{product_id:t.product_id,qty:this.productCount}};i(t.id,r).then(o=>{this.getCart()}).catch(o=>{console.error(o)})},deleteAllCart(){this.showAlert({title:"確定要移除購物車所有商品嗎？",showCancelButton:!0,icon:"info"}).then(t=>{t.isConfirmed&&l().then(r=>{this.isLoading=!1,this.getCart()})}).catch(t=>{console.error(t)})},addCart(t){C({data:{product_id:t,qty:1}}).then(o=>{this.showToast({title:"成功加入購物車",icon:"success"}),this.getCart()}).catch(o=>{console.error(o)})}}});export{y as c};
