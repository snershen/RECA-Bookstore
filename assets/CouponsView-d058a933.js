import{p as y,q as x,r as k,s as M}from"./apis-03452721.js";import{m as N}from"./modalMixin-5a2f409a.js";import{_ as f,o as a,c as d,a as e,b as r,v as u,y as P,r as _,w as b,F as C,e as L,f as m,q as V,t as h}from"./index-31ad7194.js";import{P as $}from"./PaginationComponent-9c83312e.js";import{t as U}from"./toastMixin-5c5e123e.js";import{a as B}from"./alertMixin-bc4527b4.js";import{t as D}from"./timeFormat-77515bb4.js";import"./modal-1809bb87.js";import"./selector-engine-7d65ad49.js";import"./scrollbar-fd87421e.js";const E={data(){return{modal:{},tempCoupon:{},isNew:!0}},mixins:[N],props:{innerCoupon:{type:Object,default(){return{is_enabled:0}}},innerNew:{type:Boolean,default(){return!0}}},watch:{innerCoupon(){this.tempCoupon=this.innerCoupon},innerNew(){this.isNew=this.innerNew}}},T={class:"modal fade",id:"exampleModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},F={class:"modal-dialog modal-dialog-centered modal-lg",role:"document"},j={class:"modal-content border-0"},q={class:"modal-header bg-dark text-white"},A={class:"modal-title",id:"exampleModalLabel"},I={key:0},z={key:1},G=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),O={class:"modal-body"},S={class:"row"},H={class:"col-12 col-lg-6"},J={class:"mb-3"},K=e("label",{for:"price",class:"form-label"},"折扣碼",-1),Q={class:"col-12 col-lg-6"},R={class:"mb-3"},W=e("label",{for:"title",class:"form-label"},"優惠券名稱",-1),X={class:"mb-3 col-12 col-lg-6"},Y=e("label",{for:"category",class:"form-label"},"使用期限",-1),Z={class:"mb-3 col-12 col-lg-6"},ee=e("label",{for:"origin_price",class:"form-label"},"折扣",-1),oe={class:"mb-3 col-12 col-lg-6"},te={class:"form-check"},ne=e("label",{class:"form-check-label",for:"is_enabled"}," 是否啟用 ",-1),se={class:"modal-footer"},ie=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function le(i,o,t,p,n,c){return a(),d("div",T,[e("div",F,[e("div",j,[e("div",q,[e("h5",A,[n.isNew?(a(),d("span",I,"新增優惠券")):(a(),d("span",z,"編輯優惠券"))]),G]),e("div",O,[e("div",S,[e("div",H,[e("div",J,[K,r(e("input",{type:"price",class:"form-control",id:"unit",placeholder:"請輸入折扣碼","onUpdate:modelValue":o[0]||(o[0]=s=>n.tempCoupon.code=s)},null,512),[[u,n.tempCoupon.code]])])]),e("div",Q,[e("div",R,[W,r(e("input",{type:"text",class:"form-control",id:"title",placeholder:"請輸入優惠券名稱","onUpdate:modelValue":o[1]||(o[1]=s=>n.tempCoupon.title=s)},null,512),[[u,n.tempCoupon.title]])])]),e("div",X,[Y,r(e("input",{type:"date",class:"form-control",id:"category",placeholder:"請輸入使用期限","onUpdate:modelValue":o[2]||(o[2]=s=>n.tempCoupon.due_date=s)},null,512),[[u,n.tempCoupon.due_date]])]),e("div",Z,[ee,r(e("input",{type:"number",max:"99",min:"1",class:"form-control",id:"origin_price",placeholder:"請輸入折扣","onUpdate:modelValue":o[3]||(o[3]=s=>n.tempCoupon.percent=s)},null,512),[[u,n.tempCoupon.percent]])]),e("div",oe,[e("div",te,[r(e("input",{class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,id:"is_enabled","onUpdate:modelValue":o[4]||(o[4]=s=>n.tempCoupon.is_enabled=s)},null,512),[[P,n.tempCoupon.is_enabled]]),ne])])])]),e("div",se,[ie,e("button",{type:"button",class:"btn btn-dark",onClick:o[5]||(o[5]=s=>i.$emit("update-product",n.tempCoupon))}," 確認 ")])])])],512)}const ae=f(E,[["render",le]]),de={data(){return{coupons:[],pagination:{},tempCoupon:{is_enabled:0},isLoading:!1,isNew:!0}},components:{CouponModal:ae,PaginationComponent:$},mixins:[U,B],methods:{getCoupons(i=1){this.isLoading=!0,y(i).then(o=>{this.isLoading=!1,this.coupons=o.data.coupons,this.pagination=o.data.pagination,D(this.coupons,"due_date"),this.coupons.forEach(t=>{t.percent%10===0?t.percent=`${t.percent/10} 折`:t.percent=`${t.percent} 折`})}).catch(o=>{console.error(o)})},delCoupon(i){this.showAlert({title:"確定刪除嗎?",icon:"warning",showCancelButton:!0}).then(o=>{o.isConfirmed&&x(i.id).then(t=>{this.getCoupons(),this.showAlert({icon:"success",title:t.data.message})}).catch(t=>{console.error(t)})}).catch(o=>{console.error(o)})},updateCoupon(i){const o=this.$refs.CouponModal;this.tempCoupon=i,this.tempCoupon.due_date=Number(new Date(this.tempCoupon.due_date).getTime()),this.isNew?k({data:this.tempCoupon}).then(t=>{this.getCoupons(),this.showToast({title:t.data.message,icon:"success"})}).catch(t=>{console.error(t)}):M({data:this.tempCoupon},this.tempCoupon.id).then(t=>{this.getCoupons(),this.showToast({title:t.data.message,icon:"success"})}).catch(t=>{console.error(t)}),this.tempCoupon.percent=parseInt(this.tempCoupon.percent),o.hideModal()},openModal(i,o){if(i)this.tempCoupon={is_enabled:0};else{this.tempCoupon={...o};const p=parseInt(this.tempCoupon.percent);p/10<1?this.tempCoupon.percent=p*10:this.tempCoupon.percent=p}this.isNew=i,this.$refs.CouponModal.showModal()}},created(){this.getCoupons()}},ce={class:"d-flex justify-content-between align-items-center mb-4"},pe=e("h1",{class:"fs-3 fw-bold font-sans"},"優惠券管理",-1),re={class:"table-overflow"},ue={class:"table table-hover align-middle"},me=e("thead",null,[e("tr",null,[e("th",{width:"15%"},"折扣碼"),e("th",{width:"10%"},"優惠券類型"),e("th",{width:"10%"},"優惠券折扣"),e("th",{width:"10%"},"到期日"),e("th",{width:"10%"},"是否啟用"),e("th",{width:"10%"},"編輯")])],-1),he={class:"text-right"},_e={class:"text-right"},be={key:0,class:"text-success"},Ce={key:1,class:"text-muted"},fe=["onClick"],ge=["onClick"];function we(i,o,t,p,n,c){const s=_("font-awesome-icon"),g=_("PaginationComponent"),w=_("CouponModal");return a(),d(C,null,[e("div",ce,[pe,e("button",{class:"btn btn-dark",type:"button",onClick:o[0]||(o[0]=b(l=>c.openModal(!0),["prevent"]))},"新增優惠券")]),e("div",{class:V([{isLoading:n.isLoading},"px-4 py-2 bg-white rounded-3"])},[e("div",re,[e("table",ue,[me,e("tbody",null,[(a(!0),d(C,null,L(n.coupons,l=>(a(),d("tr",{key:l.code},[e("td",null,h(l.code),1),e("td",null,h(l.title),1),e("td",he,h(l.percent),1),e("td",_e,h(l.due_date),1),e("td",null,[l.is_enabled?(a(),d("span",be,"啟用")):(a(),d("span",Ce,"未啟用"))]),e("td",null,[e("div",null,[e("button",{class:"btn btn-success btn-sm me-1",onClick:v=>c.openModal(!1,l)},[m(s,{icon:["fas","pen"]})],8,fe),e("button",{class:"btn btn-danger btn-sm",onClick:b(v=>c.delCoupon(l),["prevent"])},[m(s,{icon:["fas","trash-can"]})],8,ge)])])]))),128))])])]),m(g,{"inner-pagination":n.pagination,onEmitPage:c.getCoupons,class:"py-5"},null,8,["inner-pagination","onEmitPage"]),m(w,{ref:"CouponModal","inner-coupon":n.tempCoupon,"inner-new":n.isNew,onUpdateProduct:c.updateCoupon},null,8,["inner-coupon","inner-new","onUpdateProduct"])],2)],64)}const Ue=f(de,[["render",we]]);export{Ue as default};
