import{z as d}from"./index-0bc740d2.js";import{S as i}from"./sweetalert2.all-92ecb71d.js";import{y as u,z as c,A as e,B as l,C}from"./apis-9b5d4518.js";function s(t){let r=t.toString();return r=r.replace(/\B(?=(\d{3})+(?!\d))/g,","),r}const y=d("cartStore",{state:()=>({cartList:[],cartLength:0,saveMoney:0,productCount:0,toastContent:{},isLoading:!1}),getters:{getCartSort:t=>{t.sort(r=>a.price-b.price)}},actions:{showToast(t){i.mixin({toast:!0,position:"top",showConfirmButton:!1,timer:2500,timerProgressBar:!0,...t}).fire()},showAlert(t){return i.fire({confirmButtonText:"確定",cancelButtonText:"取消",...t})},getCart(){u().then(t=>{this.cartList=t.data.data,this.cartList.carts.forEach(r=>{r.final_total=s(r.final_total),r.total=s(r.total)}),this.cartList.final_total=Math.round(this.cartList.final_total),this.cartLength=t.data.data.carts.length,this.saveMoney=Math.round(t.data.data.total-t.data.data.final_total),this.saveMoney=s(this.saveMoney),this.cartList.final_total=s(this.cartList.final_total),this.cartList.total=s(this.cartList.total)})},deleteCart(t){c(t).then(r=>{this.getCart()})},editCart(t,r){this.productCount=t.qty,r?this.productCount++:this.productCount>0&&this.productCount--;const o={data:{product_id:t.product_id,qty:this.productCount}};e(t.id,o).then(n=>{t.qty=this.productCount,t.qty===0&&this.showAlert({title:"確定要移除該商品嗎？",showCancelButton:!0,icon:"info"}).then(h=>{h.isConfirmed&&(this.deleteCart(t.id),this.getCart())}),this.getCart()})},changeCartNum(t){if(this.productCount=t.qty,!Number(t.qty)&&t.qty!==0){this.showToast({title:"數量必須為數字",icon:"error"}),t.qty=1;return}if(t.qty<0){t.qty=1,this.productCount=t.qty;let o={data:{product_id:t.product_id,qty:this.productCount}};e(t.id,o).then(n=>{this.getCart()});return}else if(t.qty===0){this.showAlert({title:"確定要移除該商品嗎？",showDenyButton:!0,icon:"info",denyButtonText:"保留"}).then(o=>{if(o.isConfirmed){this.deleteCart(t.id),this.getCart();return}else o.isDenied&&(t.qty=1)});return}let r={data:{product_id:t.product_id,qty:this.productCount}};e(t.id,r).then(o=>{this.getCart()})},deleteAllCart(){this.showAlert({title:"確定要移除購物車所有商品嗎？",showCancelButton:!0,icon:"info"}).then(t=>{t.isConfirmed&&l().then(r=>{this.isLoading=!1,this.getCart()})})},addCart(t){C({data:{product_id:t,qty:1}}).then(o=>{this.showToast({title:"成功加入購物車",icon:"success"}),this.getCart()})}}});export{y as c};
