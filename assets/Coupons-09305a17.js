import{o as x,p as y,q as k,r as M}from"./apis-cc65c95d.js";import{m as N}from"./modalMixin-1cc43fbb.js";import{_ as f,o as a,c as d,a as e,b as r,v as u,x as P,r as _,w as b,F as C,e as L,f as m,n as $,t as h}from"./index-ed25072b.js";import{P as U}from"./Pagination-743c8e5a.js";import{t as V}from"./toastMixin-80637dd6.js";import{a as B}from"./alertMixin-0d31c50e.js";import{t as D}from"./timeFormat-77515bb4.js";import"./modal-2bc160e4.js";import"./selector-engine-03cb84f9.js";import"./scrollbar-625348d9.js";import"./sweetalert2.all-a1700339.js";const E={data(){return{modal:{},tempCoupon:{},isNew:!0}},mixins:[N],props:{innerCoupon:{type:Object,default(){return{is_enabled:0}}},innerNew:{type:Boolean,default(){return!0}}},watch:{innerCoupon(){this.tempCoupon=this.innerCoupon},innerNew(){this.isNew=this.innerNew}}},T={class:"modal fade",id:"exampleModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},F={class:"modal-dialog modal-dialog-centered modal-lg",role:"document"},j={class:"modal-content border-0"},A={class:"modal-header bg-dark text-white"},I={class:"modal-title",id:"exampleModalLabel"},q={key:0},z={key:1},G=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),O={class:"modal-body"},S={class:"row"},H={class:"col-12 col-lg-6"},J={class:"mb-3"},K=e("label",{for:"price",class:"form-label"},"折扣碼",-1),Q={class:"col-12 col-lg-6"},R={class:"mb-3"},W=e("label",{for:"title",class:"form-label"},"優惠券名稱",-1),X={class:"mb-3 col-12 col-lg-6"},Y=e("label",{for:"category",class:"form-label"},"使用期限",-1),Z={class:"mb-3 col-12 col-lg-6"},ee=e("label",{for:"origin_price",class:"form-label"},"折扣",-1),te={class:"mb-3 col-12 col-lg-6"},oe={class:"form-check"},se=e("label",{class:"form-check-label",for:"is_enabled"}," 是否啟用 ",-1),ne={class:"modal-footer"},ie=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function le(i,t,o,p,s,c){return a(),d("div",T,[e("div",F,[e("div",j,[e("div",A,[e("h5",I,[s.isNew?(a(),d("span",q,"新增優惠券")):(a(),d("span",z,"編輯優惠券"))]),G]),e("div",O,[e("div",S,[e("div",H,[e("div",J,[K,r(e("input",{type:"text",class:"form-control",id:"unit",placeholder:"請輸入折扣碼","onUpdate:modelValue":t[0]||(t[0]=n=>s.tempCoupon.code=n)},null,512),[[u,s.tempCoupon.code]])])]),e("div",Q,[e("div",R,[W,r(e("input",{type:"text",class:"form-control",id:"title",placeholder:"請輸入優惠券名稱","onUpdate:modelValue":t[1]||(t[1]=n=>s.tempCoupon.title=n)},null,512),[[u,s.tempCoupon.title]])])]),e("div",X,[Y,r(e("input",{type:"date",class:"form-control",id:"category",placeholder:"請輸入使用期限","onUpdate:modelValue":t[2]||(t[2]=n=>s.tempCoupon.due_date=n)},null,512),[[u,s.tempCoupon.due_date]])]),e("div",Z,[ee,r(e("input",{type:"number",max:"99",min:"1",class:"form-control",id:"origin_price",placeholder:"請輸入折扣","onUpdate:modelValue":t[3]||(t[3]=n=>s.tempCoupon.percent=n)},null,512),[[u,s.tempCoupon.percent]])]),e("div",te,[e("div",oe,[r(e("input",{class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,id:"is_enabled","onUpdate:modelValue":t[4]||(t[4]=n=>s.tempCoupon.is_enabled=n)},null,512),[[P,s.tempCoupon.is_enabled]]),se])])])]),e("div",ne,[ie,e("button",{type:"button",class:"btn btn-dark",onClick:t[5]||(t[5]=n=>i.$emit("update-product",s.tempCoupon))}," 確認 ")])])])],512)}const ae=f(E,[["render",le]]),de={data(){return{coupons:[],pagination:{},tempCoupon:{is_enabled:0},isLoading:!1,isNew:!0}},components:{CouponModal:ae,Pagination:U},mixins:[V,B],methods:{getCoupons(i=1){this.isLoading=!0,x(i).then(t=>{this.isLoading=!1,this.coupons=t.data.coupons,this.pagination=t.data.pagination,D(this.coupons,"due_date"),this.coupons.forEach(o=>{o.percent%10===0?o.percent=`${o.percent/10} 折`:o.percent=`${o.percent} 折`})}).catch(t=>{console.error(t)})},delCoupon(i){this.showAlert({title:"確定刪除嗎?",icon:"warning",showCancelButton:!0}).then(t=>{t.isConfirmed&&y(i.id).then(o=>{this.getCoupons(),this.showAlert({icon:"success",title:o.data.message})}).catch(o=>{console.error(o)})}).catch(t=>{console.error(t)})},updateCoupon(i){const t=this.$refs.CouponModal;this.tempCoupon=i,this.tempCoupon.due_date=Number(new Date(this.tempCoupon.due_date).getTime()),this.isNew?k({data:this.tempCoupon}).then(o=>{this.getCoupons(),this.showToast({title:o.data.message,icon:"success"})}).catch(o=>{console.error(o)}):M({data:this.tempCoupon},this.tempCoupon.id).then(o=>{this.getCoupons(),this.showToast({title:o.data.message,icon:"success"})}).catch(o=>{console.error(o)}),this.tempCoupon.percent=parseInt(this.tempCoupon.percent),t.hideModal()},openModal(i,t){if(i)this.tempCoupon={is_enabled:0};else{this.tempCoupon={...t};let p=parseInt(this.tempCoupon.percent);p/10<1?this.tempCoupon.percent=p*10:this.tempCoupon.percent=p}this.isNew=i,this.$refs.CouponModal.showModal()}},created(){this.getCoupons()}},ce={class:"d-flex justify-content-between align-items-center mb-4"},pe=e("h1",{class:"fs-3 fw-bold font-sans"},"優惠券管理",-1),re={class:"table-overflow"},ue={class:"table table-hover align-middle"},me=e("thead",null,[e("tr",null,[e("th",{width:"15%"},"折扣碼"),e("th",{width:"10%"},"優惠券類型"),e("th",{width:"10%"},"優惠券折扣"),e("th",{width:"10%"},"到期日"),e("th",{width:"10%"},"是否啟用"),e("th",{width:"10%"},"編輯")])],-1),he={class:"text-right"},_e={class:"text-right"},be={key:0,class:"text-success"},Ce={key:1,class:"text-muted"},fe=["onClick"],ge=["onClick"];function we(i,t,o,p,s,c){const n=_("font-awesome-icon"),g=_("Pagination"),w=_("CouponModal");return a(),d(C,null,[e("div",ce,[pe,e("button",{class:"btn btn-dark",type:"button",onClick:t[0]||(t[0]=b(l=>c.openModal(!0),["prevent"]))},"新增優惠券")]),e("div",{class:$([{isLoading:s.isLoading},"px-4 py-2 bg-white rounded-3"])},[e("div",re,[e("table",ue,[me,e("tbody",null,[(a(!0),d(C,null,L(s.coupons,l=>(a(),d("tr",null,[e("td",null,h(l.code),1),e("td",null,h(l.title),1),e("td",he,h(l.percent),1),e("td",_e,h(l.due_date),1),e("td",null,[l.is_enabled?(a(),d("span",be,"啟用")):(a(),d("span",Ce,"未啟用"))]),e("td",null,[e("div",null,[e("button",{class:"btn btn-success btn-sm me-1",onClick:v=>c.openModal(!1,l)},[m(n,{icon:["fas","pen"]})],8,fe),e("button",{class:"btn btn-danger btn-sm",onClick:b(v=>c.delCoupon(l),["prevent"])},[m(n,{icon:["fas","trash-can"]})],8,ge)])])]))),256))])])]),m(g,{"inner-pagination":s.pagination,onEmitPage:c.getCoupons,class:"py-5"},null,8,["inner-pagination","onEmitPage"]),m(w,{ref:"CouponModal","inner-coupon":s.tempCoupon,"inner-new":s.isNew,onUpdateProduct:c.updateCoupon},null,8,["inner-coupon","inner-new","onUpdateProduct"])],2)],64)}const Be=f(de,[["render",we]]);export{Be as default};
