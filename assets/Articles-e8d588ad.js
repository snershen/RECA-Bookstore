import{j as x,k as y,l as k,m as M,n as C}from"./apis-7153f4ff.js";import{m as N}from"./modalMixin-622d21c5.js";import{C as P}from"./ckeditor-3f5846a4.js";import{_ as A,r as f,o as c,c as r,a as t,b as d,v as _,k as V,x as D,f as p,w as b,F as g,e as L,n as U,t as u}from"./index-9f4adfae.js";import{P as T}from"./Pagination-348460e9.js";import{t as B}from"./toastMixin-e5fe9cc7.js";import{a as E}from"./alertMixin-bb6dfb1b.js";import"./modal-bc459ba7.js";import"./selector-engine-a4d6c428.js";import"./scrollbar-002013a0.js";import"./sweetalert2.all-dc88fea8.js";const j={data(){return{tempArticle:{tag:""},isNew:!0,editor:P,editorData:"<p>請輸入內容</p>",editorConfig:{}}},mixins:[N],props:{innerArticle:{type:Object,default(){return{}}},innerNew:{type:Boolean,default(){return!0}}},watch:{innerArticle(){this.tempArticle=this.innerArticle},innerNew(){this.isNew=this.innerNew}},created(){this.tempArticle.isPublic=!1}},F={class:"modal fade",id:"exampleModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},S={class:"modal-dialog modal-dialog-centered modal-lg",role:"document"},$={class:"modal-content border-0"},G={class:"modal-header bg-dark text-white"},z={class:"modal-title",id:"exampleModalLabel"},O={key:0},Y={key:1},q=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),H={class:"modal-body"},I={class:"row"},J={class:"col-12 col-lg-6"},K={class:"mb-3"},Q=t("label",{for:"price",class:"form-label"},"文章名稱",-1),R={class:"mb-3 col-12 col-lg-6"},W=t("label",{for:"category",class:"form-label"},"上傳圖片",-1),X={class:"mb-3 col-12 col-lg-6"},Z=t("label",{for:"origin_price",class:"form-label"},"作者",-1),tt={class:"mb-3 col-6"},et=t("label",{for:"tag",class:"form-label"},"標籤",-1),st=t("option",{value:"",disabled:"",selected:""},"選擇標籤",-1),ot=t("option",{value:"編輯精選"},"編輯精選",-1),it=t("option",{value:"讀者投稿"},"讀者投稿",-1),lt=[st,ot,it],nt={class:"mb-3 col-12 col-lg-6"},at={class:"form-check"},ct=t("label",{class:"form-check-label",for:"is_enabled"}," 是否公開",-1),rt={class:"col-12"},dt={class:"mb-3"},mt=t("label",{for:"title",class:"form-label"},"文章描述",-1),pt={class:"mb-3 col-12"},ht={class:"form-check ps-0"},_t=t("label",{for:"title",class:"form-label"},"文章內容",-1),ut={class:"modal-footer"},ft=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function bt(l,e,o,m,s,a){const h=f("ckeditor");return c(),r("div",F,[t("div",S,[t("div",$,[t("div",G,[t("h5",z,[s.isNew?(c(),r("span",O,"新增文章")):(c(),r("span",Y,"編輯文章"))]),q]),t("div",H,[t("div",I,[t("div",J,[t("div",K,[Q,d(t("input",{type:"text",class:"form-control",id:"unit",placeholder:"請輸入文章名稱","onUpdate:modelValue":e[0]||(e[0]=i=>s.tempArticle.title=i)},null,512),[[_,s.tempArticle.title]])])]),t("div",R,[W,d(t("input",{type:"text",class:"form-control",id:"category",placeholder:"請輸入圖片網址","onUpdate:modelValue":e[1]||(e[1]=i=>s.tempArticle.image=i)},null,512),[[_,s.tempArticle.image]])]),t("div",X,[Z,d(t("input",{type:"text",class:"form-control",id:"origin_price",placeholder:"請輸入作者","onUpdate:modelValue":e[2]||(e[2]=i=>s.tempArticle.author=i)},null,512),[[_,s.tempArticle.author]])]),t("div",tt,[et,d(t("select",{class:"form-select w-100","aria-label":"Default select example",id:"tag","onUpdate:modelValue":e[3]||(e[3]=i=>s.tempArticle.tag=i)},lt,512),[[V,s.tempArticle.tag]])]),t("div",nt,[t("div",at,[d(t("input",{class:"form-check-input",type:"checkbox","true-value":!0,"false-value":!1,id:"is_enabled","onUpdate:modelValue":e[4]||(e[4]=i=>s.tempArticle.isPublic=i)},null,512),[[D,s.tempArticle.isPublic]]),ct])]),t("div",rt,[t("div",dt,[mt,d(t("textarea",{type:"text",class:"form-control",id:"title",placeholder:"請輸入文章描述","onUpdate:modelValue":e[5]||(e[5]=i=>s.tempArticle.description=i)},null,512),[[_,s.tempArticle.description]])])]),t("div",pt,[t("div",ht,[_t,p(h,{editor:s.editor,modelValue:s.tempArticle.content,"onUpdate:modelValue":e[6]||(e[6]=i=>s.tempArticle.content=i),config:s.editorConfig},null,8,["editor","modelValue","config"])])])])]),t("div",ut,[ft,t("button",{type:"button",class:"btn btn-dark",onClick:e[7]||(e[7]=i=>l.$emit("update-article",s.tempArticle))}," 確認 ")])])])],512)}const gt=A(j,[["render",bt]]),At={data(){return{articles:[],pagination:{},tempArticle:{},isLoading:!1,isNew:!0}},components:{ArticleModal:gt,Pagination:T},mixins:[B,E],methods:{getArticles(l=1){this.isLoading=!0,x(l).then(e=>{this.isLoading=!1,this.articles=e.data.articles,this.pagination=e.data.pagination,this.articles.forEach(o=>{const m=new Date(o.create_at).getFullYear(),s=new Date(o.create_at).getMonth()+1,a=new Date(o.create_at).getDate();o.create_at=`${m}-${s}-${a}`})}).catch(e=>{console.error(e)})},openModal(l,e){l?this.tempArticle={isPublic:!1}:y(e.id).then(m=>{this.tempArticle=m.data.article}),this.isNew=l,this.$refs.ArticleModal.showModal()},deleteArticle(l){this.showAlert({title:"確定刪除嗎?",icon:"warning",showCancelButton:!0}).then(e=>{e.isConfirmed&&k(l.id).then(o=>{this.getArticles()}).catch(o=>{console.error(o)})})},updateArticle(l){const e=this.$refs.ArticleModal;this.tempArticle={...l},this.isNew?(this.tempArticle.create_at=new Date().getTime(),M({data:this.tempArticle}).then(o=>{this.isLoading=!0,o.response&&this.showToast({title:o.response.data.message,icon:"error"}),o.data&&(this.showToast({title:o.data.message,icon:"success"}),this.getArticles(),e.hideModal())}).catch(o=>{console.error(o)}).finally(()=>{this.isLoading=!1})):C(l.id,{data:this.tempArticle}).then(o=>{o.response&&this.showToast({title:o.response.data.message,icon:"error"}),o.data&&(this.showToast({title:o.data.message,icon:"success"}),this.getArticles(),e.hideModal())}).catch(o=>{console.error(o)})}},created(){this.getArticles()}},wt={class:"d-flex justify-content-between align-items-center mb-4"},vt=t("h1",{class:"fs-3 fw-bold font-sans"},"文章管理",-1),xt={class:"table-overflow"},yt={class:"table table-hover align-middle"},kt=t("thead",null,[t("tr",null,[t("th",{width:"10%"},"建立時間"),t("th",{width:"30%"},"文章名稱"),t("th",{width:"10%"},"作者"),t("th",{width:"10%"},"標籤"),t("th",{width:"10%"},"是否公開"),t("th",{width:"10%"},"編輯")])],-1),Mt={class:"text-right"},Ct={class:"text-right"},Nt={key:0,class:"text-success"},Pt={key:1,class:"text-muted"},Vt=["onClick"],Dt=["onClick"];function Lt(l,e,o,m,s,a){const h=f("font-awesome-icon"),i=f("Pagination"),w=f("ArticleModal");return c(),r(g,null,[t("div",wt,[vt,t("button",{class:"btn btn-dark",type:"button",onClick:e[0]||(e[0]=b(n=>a.openModal(!0),["prevent"]))},"新增文章")]),t("div",{class:U([{isLoading:s.isLoading},"px-4 py-2 bg-white rounded-3"])},[t("div",xt,[t("table",yt,[kt,t("tbody",null,[(c(!0),r(g,null,L(s.articles,n=>(c(),r("tr",{key:n.id},[t("td",null,u(n.create_at),1),t("td",null,u(n.title),1),t("td",Mt,u(n.author),1),t("td",Ct,u(n.tag),1),t("td",null,[n.isPublic?(c(),r("span",Nt,"公開")):(c(),r("span",Pt,"未公開"))]),t("td",null,[t("div",null,[t("button",{class:"btn btn-success btn-sm me-1",onClick:v=>a.openModal(!1,n)},[p(h,{icon:["fas","pen"]})],8,Vt),t("button",{class:"btn btn-danger btn-sm",onClick:b(v=>a.deleteArticle(n),["prevent"])},[p(h,{icon:["fas","trash-can"]})],8,Dt)])])]))),128))])])]),p(i,{"inner-pagination":s.pagination,onEmitPage:a.getArticles,class:"py-5"},null,8,["inner-pagination","onEmitPage"]),p(w,{ref:"ArticleModal",onUpdateArticle:a.updateArticle,innerArticle:s.tempArticle,innerNew:s.isNew},null,8,["onUpdateArticle","innerArticle","innerNew"])],2)],64)}const Yt=A(At,[["render",Lt]]);export{Yt as default};
