import{z as l}from"./index-9f4adfae.js";import{s as e,k as c,n as h}from"./apis-7153f4ff.js";import{t as i}from"./timeFormat-77515bb4.js";import{S as u}from"./sweetalert2.all-dc88fea8.js";const f=l("adminOrderStore",{state:()=>({orderList:[],orderAll:[],productSoldNum:{},sortSoldNum:[],pagination:{},isLoading:!1}),actions:{showToast(o){u.mixin({toast:!0,position:"top",showConfirmButton:!1,timer:2500,timerProgressBar:!0,...o}).fire()},getOrder(o=1){this.isLoading=!0,e(o).then(r=>{this.orderList=r.data.orders,this.pagination=r.data.pagination,i(this.orderList),this.isLoading=!1,this.orderList.forEach(t=>{t.total=Math.round(t.total),i(t,"create_at")})})},async getOrderAll(){let o={...this.pagination};this.orderAll=[];let r=o.current_page;for(;o.has_next;)await e(r).then(t=>{o=t.data.pagination,r++;const s=t.data.orders;this.orderAll.push(...s)}).catch(t=>console.error(t))},async calcOrderNum(){await this.getOrderAll();const o=this.orderAll.map(t=>Object.keys(t.products));let r=[];o.forEach((t,s)=>{t.forEach(a=>{r.push(this.orderAll[s].products[a])})}),this.productSoldNum=[],r.forEach(t=>{if(this.productSoldNum[t.id])this.productSoldNum[t.id].qty+=t.qty;else{const{id:s,qty:a,product:d}=t,n={id:s,qty:a,product:d};this.productSoldNum[t.id]=n}}),this.sortSoldNum=Object.values(this.productSoldNum).sort((t,s)=>s.qty-t.qty),this.sortSoldNum.length>10&&(this.sortSoldNum=this.sortSoldNum.slice(0,10)),console.log(this.sortSoldNum)},async sendRankInfo(){const o="-NrQ8wc--1weD4FTHjHH";c(o).then(r=>{this.calcOrderNum(),console.log(r.data);const t=r.data.article;return t.content=JSON.stringify(this.sortSoldNum),t}).then(r=>{h(o,{data:r}).then(t=>{this.showToast({title:"已更新排行榜",icon:"success"})}).catch(t=>{console.error(t)})})}}});export{f as a};
