import{$ as l}from"./index-f2fabb71.js";import{S as c}from"./sweetalert2.all-b2eb1d9f.js";import{D as a,E as o,F as h}from"./apis-ec1d0107.js";const d=l("productStore",{state:()=>({productList:[],productAll:[],pagination:{},singleProduct:{},categoryList:[],filterResult:[],selectedCategory:"全部",sortStatus:!1,sortTarget:"",searchString:"",searchResult:[],isEmptyResult:!1,alikeProduct:[],isLoading:!1,collectList:[],collectStorage:[]}),actions:{showToast(t){c.mixin({toast:!0,position:"top",showConfirmButton:!1,timer:2500,timerProgressBar:!0,...t}).fire()},async getProductAll(){try{const t=await a();return this.productAll=t.data.products,this.renderCategory(),t.data.products}catch(t){throw console.error("Error fetching data:",t),t}finally{this.isLoading=!1}},async getProducts(t=1){try{this.isLoading=!0;const e=await o(t),{products:s,pagination:r}=e.data;this.selectedCategory==="全部"&&(this.filterResult=s,this.pagination=r),this.productList=s}catch(e){throw console.error("Error fetching data:",e),e}finally{this.isLoading=!1}},async getSingleProduct(t){try{this.isLoading=!0;const e=await h(t);this.singleProduct=e.data.product,this.showAlikeProduct(this.singleProduct)}catch(e){throw console.error("Error fetching data:",e),e}finally{this.isLoading=!1}},async renderCategory(){const t={};[...this.productAll].forEach(s=>{t[s.category]?t[s.category]++:t[s.category]=1}),this.categoryList=Object.keys(t)},async filterProduct(t,e){try{this.isEmptyResult=!1,this.searchResult=[],this.selectedCategory=t==="全部"?"全部":t;const s=await o(1,t==="全部"?"":t),{products:r,pagination:i}=s.data;return this.filterResult=r,this.pagination=i,e||(this.singleProduct=""),r}catch(s){throw console.error("Error fetching data:",s),s}},async searchProduct(t){try{this.isEmptyResult=!1,this.searchResult=[],this.searchString=t;const e=await this.productAll.filter(s=>s.title.includes(t));this.searchResult=e,this.selectedCategory="全部",this.searchResult.length===0&&(this.isEmptyResult=!0)}catch(e){throw console.error("Error fetching data:",e),e}},showAlikeProduct(t){const e=this.productAll.filter(s=>{if(s.id!==t.id)return s.category===t.category});this.alikeProduct=e},getStorage(){localStorage.getItem("collectList")&&(this.collectStorage=JSON.parse(localStorage.getItem("collectList")))},addOrRemoveCollect(t,e){if(!localStorage.getItem("collectList")&&e){this.collectList.push({...t,isSolid:e}),localStorage.setItem("collectList",JSON.stringify(this.collectList)),this.collectStorage=JSON.parse(localStorage.getItem("collectList")),this.showToast({title:"收藏成功",icon:"success"});return}if(this.collectStorage=JSON.parse(localStorage.getItem("collectList")),this.collectList=this.collectStorage,e){if(this.collectStorage.findIndex(r=>t.id===r.id)!==-1)return;this.collectList.push({...t,isSolid:e}),this.showToast({title:"收藏成功",icon:"success"}),localStorage.setItem("collectList",JSON.stringify(this.collectList)),this.collectStorage=JSON.parse(localStorage.getItem("collectList"))}else{const s=this.collectStorage.findIndex(r=>t.id===r.id);this.collectList.splice(s,1),localStorage.setItem("collectList",JSON.stringify(this.collectList)),this.showToast({title:"已取消收藏",icon:"info"}),this.collectStorage=JSON.parse(localStorage.getItem("collectList"))}},sortProduct(t){if(t==="price"?this.sortTarget="price":t==="time"?this.sortTarget="time":t==="soldNum"&&(this.sortTarget="soldNum"),t==="time"){this.sortStatus?(this.filterResult=[...this.filterResult].sort((e,s)=>s.time.localeCompare(e.time)),this.sortStatus=!this.sortStatus):(this.filterResult=[...this.filterResult].sort((e,s)=>e.time.localeCompare(s.time)),this.sortStatus=!this.sortStatus);return}this.sortStatus?(this.filterResult=[...this.filterResult].sort((e,s)=>s[this.sortTarget]-e[this.sortTarget]),this.sortStatus=!this.sortStatus):(this.filterResult=[...this.filterResult].sort((e,s)=>e[this.sortTarget]-s[this.sortTarget]),this.sortStatus=!this.sortStatus),console.log(this.filterResult)}}});export{d as p};
