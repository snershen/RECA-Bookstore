import{_ as u,o as d,c as n,a as s,t as o,F as m,e as g,l as v,i as y,u as k,x,r as h,f as _,q as C,w as P}from"./index-31ad7194.js";import{a as p}from"./order-eb3eba31.js";import{a as M}from"./alertMixin-bc4527b4.js";import{t as L}from"./toastMixin-5c5e123e.js";import{i as $,j as N}from"./apis-03452721.js";import{m as S}from"./modalMixin-5a2f409a.js";import{P as j}from"./PaginationComponent-9c83312e.js";import"./timeFormat-77515bb4.js";import"./modal-1809bb87.js";import"./selector-engine-7d65ad49.js";import"./scrollbar-fd87421e.js";const V={data(){return{modal:{},tempOrder:{},orderProductList:[]}},methods:{getOrderItem(){const i=Object.keys(this.tempOrder.products).map(a=>this.tempOrder.products[a]);this.orderProductList=i},changePayStatus(){this.tempOrder.is_paid=!this.tempOrder.is_paid}},mixins:[S],props:{innerOrder:{type:Object,default(){return{}}}},watch:{innerOrder(){this.tempOrder=this.innerOrder,this.getOrderItem()}}},A={class:"modal fade modal-lg",id:"exampleModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},B={class:"modal-dialog modal-dialog-centered",role:"document"},I={class:"modal-content border-0 p-0"},E=s("div",{class:"modal-header bg-dark text-white"},[s("h2",{class:"modal-title fs-4 font-sans",id:"exampleModalLabel"},[s("span",null,"訂單詳細")]),s("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),q={key:0,class:"modal-body bg-light fs-lg-6 fs-7"},D={class:"py-2 p-lg-3 p-2 rounded-1 mb-2"},F={class:"row"},G=s("div",{class:"col-lg-2 col-4"},"訂單成立日期",-1),R={class:"col-lg-10 col-8"},T=s("div",{class:"col-lg-2 col-4"},"訂單編號",-1),z={class:"col-lg-10 col-8"},H={class:"bg-white p-lg-3 p-2 rounded-1 mb-3"},J=s("h2",{class:"font-sans fs-6 mb-2 fw-bold"},"客戶資訊",-1),K={class:"row mb-1"},Q=s("div",{class:"col-lg-2 col-4"},"姓名",-1),U={class:"col-lg-10 col-8"},W={class:"row mb-1"},X=s("div",{class:"col-lg-2 col-4"},"電子信箱",-1),Y={class:"col-lg-10 col-8"},Z={class:"row mb-1"},ss=s("div",{class:"col-lg-2 col-4"},"地址",-1),ts={class:"col-lg-10 col-8"},es={class:"row mb-1"},os=s("div",{class:"col-lg-2 col-4"},"聯絡電話",-1),ds={class:"col-lg-10 col-8"},ns={class:"row mb-1"},is=s("div",{class:"col-lg-2 col-4"},"付款方式",-1),ls={class:"col-lg-10 col-8"},cs={class:"row mb-1"},as=s("div",{class:"col-lg-2 col-4"},"付款狀態",-1),rs={class:"col-lg-10 col-8"},_s={key:0,class:"text-success fw-bold"},hs={key:1,class:"text-danger fw-bold"},ms={class:"row mb-1"},ps=s("div",{class:"col-lg-2 col-4"},"總金額",-1),us={class:"col-lg-10 col-8"},gs={class:"row mb-1"},bs=s("div",{class:"col-lg-2 col-4"},"備註",-1),fs={class:"col-lg-10 col-8"},ws={key:0},Os={key:1},vs={class:"bg-white p-lg-3 p-2 pb-3 rounded-1 mb-3"},ys=s("h2",{class:"font-sans fs-6 mb-2 fw-bold"},"購買明細",-1),ks={width:"100%"},xs=s("thead",{class:"bg-light fs-7"},[s("tr",null,[s("td",{class:"p-1"},"書名"),s("td",{class:"p-1"},"數量"),s("td",{class:"p-1"},"總額")])],-1),Cs={class:"fs-7"},Ps={width:"70%",class:"p-1"},Ms={width:"15%",class:"p-1"},Ls={width:"15%",class:"p-1"},$s={class:"d-flex justify-content-end"},Ns=["checked"],Ss=s("label",{for:"changePay"},[y("修改付款狀態為 "),s("span",{class:"text-success fw-bold"},"已付款")],-1),js={class:"modal-footer"},Vs=s("button",{type:"button",class:"btn btn-outline-dark","data-bs-dismiss":"modal"},"關閉",-1);function As(e,i,a,b,t,r){return d(),n("div",A,[s("div",B,[s("div",I,[E,t.tempOrder.user?(d(),n("div",q,[s("div",D,[s("div",F,[G,s("div",R,o(t.tempOrder.create_at),1),T,s("div",z,o(t.tempOrder.id),1)])]),s("div",H,[J,s("ul",null,[s("li",K,[Q,s("div",U,o(t.tempOrder.user.name),1)]),s("li",W,[X,s("div",Y,o(t.tempOrder.user.email),1)]),s("li",Z,[ss,s("div",ts,o(t.tempOrder.user.address),1)]),s("li",es,[os,s("div",ds,o(t.tempOrder.user.tel),1)]),s("li",ns,[is,s("div",ls,o(t.tempOrder.user.pay),1)]),s("li",cs,[as,s("div",rs,[t.tempOrder.is_paid?(d(),n("span",_s,"已付款")):(d(),n("span",hs,"未付款"))])]),s("li",ms,[ps,s("div",us,o(t.tempOrder.total),1)]),s("li",gs,[bs,s("div",fs,[t.tempOrder.message?(d(),n("div",ws,o(t.tempOrder.message),1)):(d(),n("div",Os,"無"))])])])]),s("div",vs,[ys,s("table",ks,[xs,s("tbody",Cs,[(d(!0),n(m,null,g(t.orderProductList,l=>(d(),n("tr",{key:l.id,class:"mb-1 border-bottom"},[s("td",Ps,o(l.product.title),1),s("td",Ms,o(l.qty),1),s("td",Ls,o(l.total),1)]))),128))])])]),s("div",$s,[s("input",{type:"checkbox",id:"changePay",class:"me-2",onClick:i[0]||(i[0]=(...l)=>r.changePayStatus&&r.changePayStatus(...l)),checked:t.tempOrder.is_paid},null,8,Ns),Ss])])):v("",!0),s("div",js,[Vs,s("button",{type:"button",class:"btn btn-dark","data-bs-dismiss":"modal",onClick:i[1]||(i[1]=l=>e.$emit("change-pay",t.tempOrder))}," 修改 ")])])])],512)}const Bs=u(V,[["render",As]]),Is={data(){return{tempOrder:{}}},components:{OrderModal:Bs,PaginationComponent:j},mixins:[M,L],computed:{...k(p,["orderList","pagination","isLoading"])},methods:{...x(p,["getOrder","getOrderAll","sendRankInfo","calcOrderNum"]),updateOrder(e){const i={is_paid:e.is_paid};$({data:i},e.id).then(()=>{this.showToast({title:"已更新訂單資訊",icon:"success"}),this.getOrder()}).catch(a=>{console.error(a)})},delOrder(e){this.showAlert({title:`確定刪除訂單 ${e.id} 嗎?`,icon:"warning",showCancelButton:!0}).then(i=>{i.isConfirmed&&N(e.id).then(()=>{this.getOrder()}).catch(a=>{console.error(a)})})},openModal(e){this.tempOrder={...e},this.$refs.orderModal.showModal()}},async created(){await this.getOrder(),await this.getOrderAll(),await this.calcOrderNum()},mounted(){this.sendRankInfo()}},Es=s("div",{class:"d-flex justify-content-between align-items-center mb-4"},[s("h1",{class:"fs-3 fw-bold font-sans"},"訂單管理")],-1),qs={class:"table-overflow"},Ds={class:"table table-hover mt-4 align-middle w-100"},Fs=s("thead",null,[s("tr",null,[s("th",{width:"30%"},"訂單編號"),s("th",{width:"20%"},"付款日期"),s("th",{width:"10%"},"付款狀態"),s("th",{width:"20%"},"客戶姓名"),s("th",{width:"10%"},"合計"),s("th",{width:"10%"},"編輯")])],-1),Gs={key:0},Rs=s("tr",null,[s("td",{colspan:"6",class:"text-center"},"目前無訂單")],-1),Ts=[Rs],zs={key:1},Hs={class:"text-right"},Js={key:0,class:"badge text-white bg-success fs-7 fw-normal"},Ks={key:1,class:"badge text-white bg-gray fs-7 fw-normal"},Qs=["onClick"],Us=["onClick"];function Ws(e,i,a,b,t,r){const l=h("font-awesome-icon"),f=h("OrderModal"),w=h("PaginationComponent");return d(),n(m,null,[Es,s("div",{class:C([{isLoading:e.isLoading},"px-4 py-2 bg-white rounded-3"])},[s("div",qs,[s("table",Ds,[Fs,e.orderList.length===0?(d(),n("tbody",Gs,Ts)):(d(),n("tbody",zs,[(d(!0),n(m,null,g(e.orderList,c=>(d(),n("tr",{key:c.id},[s("td",null,o(c.id),1),s("td",Hs,o(c.create_at),1),s("td",null,[c.is_paid?(d(),n("span",Js,"已付款")):(d(),n("span",Ks,"未付款"))]),s("td",null,o(c.user.name),1),s("td",null,o(c.total),1),s("td",null,[s("div",null,[s("button",{class:"btn btn-dark btn-sm me-1",onClick:O=>r.openModal(c)},[_(l,{icon:["far","file-lines"]})],8,Qs),s("button",{class:"btn btn-danger btn-sm",onClick:P(O=>r.delOrder(c),["prevent"])},[_(l,{icon:["fas","trash-can"]})],8,Us)])])]))),128))])),_(f,{ref:"orderModal","inner-order":t.tempOrder,onChangePay:r.updateOrder},null,8,["inner-order","onChangePay"])])]),_(w,{"inner-pagination":e.pagination,onEmitPage:e.getOrder,class:"py-5"},null,8,["inner-pagination","onEmitPage"])],2)],64)}const ct=u(Is,[["render",Ws]]);export{ct as default};
