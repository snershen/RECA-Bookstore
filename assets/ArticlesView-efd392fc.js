import{k as y,l as x,m as k,n as M,o as C}from"./apis-b1e9b367.js";import{m as N}from"./modalMixin-d8c95d25.js";import{C as P}from"./ckeditor-2d040b4c.js";import{_ as A,r as f,o as r,c as d,a as t,b as p,v as _,m as V,y as D,f as h,w as b,F as g,e as L,q as U,t as u}from"./index-6b9a9c15.js";import{P as T}from"./PaginationComponent-7beda117.js";import{t as B}from"./toastMixin-b579257b.js";import{a as E}from"./alertMixin-35895543.js";import"./modal-c1b2046c.js";import"./selector-engine-6a870d2a.js";import"./scrollbar-ce572303.js";const F={data(){return{tempArticle:{tag:""},isNew:!0,editor:P,editorData:"<p>請輸入內容</p>",editorConfig:{}}},mixins:[N],props:{innerArticle:{type:Object,default(){return{}}},innerNew:{type:Boolean,default(){return!0}}},watch:{innerArticle(){this.tempArticle=this.innerArticle},innerNew(){this.isNew=this.innerNew}},created(){this.tempArticle.isPublic=!1}},S={class:"modal fade",id:"exampleModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},$={class:"modal-dialog modal-dialog-centered modal-lg",role:"document"},j={class:"modal-content border-0"},G={class:"modal-header bg-dark text-white"},q={class:"modal-title",id:"exampleModalLabel"},z={key:0},O={key:1},R=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),Y={class:"modal-body"},H={class:"row"},I={class:"col-12 col-lg-6"},J={class:"mb-3"},K=t("label",{for:"price",class:"form-label"},"文章名稱",-1),Q={class:"mb-3 col-12 col-lg-6"},W=t("label",{for:"category",class:"form-label"},"上傳圖片",-1),X={class:"mb-3 col-12 col-lg-6"},Z=t("label",{for:"origin_price",class:"form-label"},"作者",-1),tt={class:"mb-3 col-6"},et=t("label",{for:"tag",class:"form-label"},"標籤",-1),st=t("option",{value:"",disabled:"",selected:""},"選擇標籤",-1),ot=t("option",{value:"編輯精選"},"編輯精選",-1),it=t("option",{value:"讀者投稿"},"讀者投稿",-1),lt=[st,ot,it],nt={class:"mb-3 col-12 col-lg-6"},at={class:"form-check"},ct=t("label",{class:"form-check-label",for:"is_enabled"}," 是否公開",-1),rt={class:"col-12"},dt={class:"mb-3"},mt=t("label",{for:"title",class:"form-label"},"文章描述",-1),pt={class:"mb-3 col-12"},ht={class:"form-check ps-0"},_t=t("label",{for:"title",class:"form-label"},"文章內容",-1),ut={class:"modal-footer"},ft=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function bt(l,e,o,n,s,c){const m=f("ckeditor");return r(),d("div",S,[t("div",$,[t("div",j,[t("div",G,[t("h5",q,[s.isNew?(r(),d("span",z,"新增文章")):(r(),d("span",O,"編輯文章"))]),R]),t("div",Y,[t("div",H,[t("div",I,[t("div",J,[K,p(t("input",{type:"text",class:"form-control",id:"unit",placeholder:"請輸入文章名稱","onUpdate:modelValue":e[0]||(e[0]=i=>s.tempArticle.title=i)},null,512),[[_,s.tempArticle.title]])])]),t("div",Q,[W,p(t("input",{type:"text",class:"form-control",id:"category",placeholder:"請輸入圖片網址","onUpdate:modelValue":e[1]||(e[1]=i=>s.tempArticle.image=i)},null,512),[[_,s.tempArticle.image]])]),t("div",X,[Z,p(t("input",{type:"text",class:"form-control",id:"origin_price",placeholder:"請輸入作者","onUpdate:modelValue":e[2]||(e[2]=i=>s.tempArticle.author=i)},null,512),[[_,s.tempArticle.author]])]),t("div",tt,[et,p(t("select",{class:"form-select w-100","aria-label":"Default select example",id:"tag","onUpdate:modelValue":e[3]||(e[3]=i=>s.tempArticle.tag=i)},lt,512),[[V,s.tempArticle.tag]])]),t("div",nt,[t("div",at,[p(t("input",{class:"form-check-input",type:"checkbox","true-value":!0,"false-value":!1,id:"is_enabled","onUpdate:modelValue":e[4]||(e[4]=i=>s.tempArticle.isPublic=i)},null,512),[[D,s.tempArticle.isPublic]]),ct])]),t("div",rt,[t("div",dt,[mt,p(t("textarea",{type:"text",class:"form-control",id:"title",placeholder:"請輸入文章描述","onUpdate:modelValue":e[5]||(e[5]=i=>s.tempArticle.description=i)},null,512),[[_,s.tempArticle.description]])])]),t("div",pt,[t("div",ht,[_t,h(m,{editor:s.editor,modelValue:s.tempArticle.content,"onUpdate:modelValue":e[6]||(e[6]=i=>s.tempArticle.content=i),config:s.editorConfig},null,8,["editor","modelValue","config"])])])])]),t("div",ut,[ft,t("button",{type:"button",class:"btn btn-dark",onClick:e[7]||(e[7]=i=>l.$emit("update-article",s.tempArticle))}," 確認 ")])])])],512)}const gt=A(F,[["render",bt]]),At={data(){return{articles:[],pagination:{},tempArticle:{},isLoading:!1,isNew:!0}},components:{ArticleModal:gt,PaginationComponent:T},mixins:[B,E],methods:{getArticles(l=1){this.isLoading=!0,y(l).then(e=>{this.isLoading=!1;const o=e.data.articles.filter(n=>n.author!=="系統");this.articles=o,this.pagination=e.data.pagination,this.articles.forEach(n=>{const s=new Date(n.create_at).getFullYear(),c=new Date(n.create_at).getMonth()+1,m=new Date(n.create_at).getDate();n.create_at=`${s}-${c}-${m}`})}).catch(e=>{console.error(e)})},openModal(l,e){l?this.tempArticle={isPublic:!1}:x(e.id).then(n=>{this.tempArticle=n.data.article}),this.isNew=l,this.$refs.ArticleModal.showModal()},deleteArticle(l){this.showAlert({title:"確定刪除嗎?",icon:"warning",showCancelButton:!0}).then(e=>{e.isConfirmed&&k(l.id).then(o=>{this.getArticles()}).catch(o=>{console.error(o)})})},updateArticle(l){const e=this.$refs.ArticleModal;this.tempArticle={...l},this.isNew?(this.tempArticle.create_at=new Date().getTime(),M({data:this.tempArticle}).then(o=>{this.isLoading=!0,o.response&&this.showToast({title:o.response.data.message,icon:"error"}),o.data&&(this.showToast({title:o.data.message,icon:"success"}),this.getArticles(),e.hideModal())}).catch(o=>{console.error(o)}).finally(()=>{this.isLoading=!1})):C(l.id,{data:this.tempArticle}).then(o=>{o.response&&this.showToast({title:o.response.data.message,icon:"error"}),o.data&&(this.showToast({title:o.data.message,icon:"success"}),this.getArticles(),e.hideModal())}).catch(o=>{console.error(o)})}},created(){this.getArticles()}},wt={class:"d-flex justify-content-between align-items-center mb-4"},vt=t("h1",{class:"fs-3 fw-bold font-sans"},"文章管理",-1),yt={class:"table-overflow"},xt={class:"table table-hover align-middle"},kt=t("thead",null,[t("tr",null,[t("th",{width:"10%"},"建立時間"),t("th",{width:"30%"},"文章名稱"),t("th",{width:"10%"},"作者"),t("th",{width:"10%"},"標籤"),t("th",{width:"10%"},"是否公開"),t("th",{width:"10%"},"編輯")])],-1),Mt={class:"text-right"},Ct={class:"text-right"},Nt={key:0,class:"text-success"},Pt={key:1,class:"text-muted"},Vt=["onClick"],Dt=["onClick"];function Lt(l,e,o,n,s,c){const m=f("font-awesome-icon"),i=f("PaginationComponent"),w=f("ArticleModal");return r(),d(g,null,[t("div",wt,[vt,t("button",{class:"btn btn-dark",type:"button",onClick:e[0]||(e[0]=b(a=>c.openModal(!0),["prevent"]))},"新增文章")]),t("div",{class:U([{isLoading:s.isLoading},"px-4 py-2 bg-white rounded-3"])},[t("div",yt,[t("table",xt,[kt,t("tbody",null,[(r(!0),d(g,null,L(s.articles,a=>(r(),d("tr",{key:a.id},[t("td",null,u(a.create_at),1),t("td",null,u(a.title),1),t("td",Mt,u(a.author),1),t("td",Ct,u(a.tag),1),t("td",null,[a.isPublic?(r(),d("span",Nt,"公開")):(r(),d("span",Pt,"未公開"))]),t("td",null,[t("div",null,[t("button",{class:"btn btn-success btn-sm me-1",onClick:v=>c.openModal(!1,a)},[h(m,{icon:["fas","pen"]})],8,Vt),t("button",{class:"btn btn-danger btn-sm",onClick:b(v=>c.deleteArticle(a),["prevent"])},[h(m,{icon:["fas","trash-can"]})],8,Dt)])])]))),128))])])]),h(i,{"inner-pagination":s.pagination,onEmitPage:c.getArticles,class:"py-5"},null,8,["inner-pagination","onEmitPage"]),h(w,{ref:"ArticleModal",onUpdateArticle:c.updateArticle,innerArticle:s.tempArticle,innerNew:s.isNew},null,8,["onUpdateArticle","innerArticle","innerNew"])],2)],64)}const zt=A(At,[["render",Lt]]);export{zt as default};
