import{z as c}from"./index-a371b580.js";import{t as e,l,o as h}from"./apis-a18fc85a.js";import{t as i}from"./timeFormat-77515bb4.js";const g=c("adminOrderStore",{state:()=>({orderList:[],orderAll:[],productSoldNum:{},sortSoldNum:[],pagination:{},isLoading:!1}),actions:{getOrder(o=1){this.isLoading=!0,e(o).then(r=>{this.orderList=r.data.orders,this.pagination=r.data.pagination,i(this.orderList),this.isLoading=!1,this.orderList.forEach(t=>{t.total=Math.round(t.total),i(t,"create_at")})})},async getOrderAll(){let o={...this.pagination};this.orderAll=[];let r=o.current_page;for(o.has_next||await e(r).then(t=>{const s=t.data.orders;this.orderAll.push(...s)}).catch(t=>console.error(t));o.has_next;)await e(r).then(t=>{o=t.data.pagination,r++;const s=t.data.orders;this.orderAll.push(...s)}).catch(t=>console.error(t))},async calcOrderNum(){await this.getOrderAll();const o=this.orderAll.map(t=>Object.keys(t.products)),r=[];o.forEach((t,s)=>{t.forEach(a=>{r.push(this.orderAll[s].products[a])})}),this.productSoldNum=[],r.forEach(t=>{if(this.productSoldNum[t.id])this.productSoldNum[t.id].qty+=t.qty;else{const{id:s,qty:a,product:d}=t,n={id:s,qty:a,product:d};this.productSoldNum[t.id]=n}}),this.sortSoldNum=Object.values(this.productSoldNum).sort((t,s)=>s.qty-t.qty),this.sortSoldNum.length>10&&(this.sortSoldNum=this.sortSoldNum.slice(0,10))},async sendRankInfo(){const o="-NrQ8wc--1weD4FTHjHH";l(o).then(r=>{this.calcOrderNum();const t=r.data.article;return t.content=JSON.stringify(this.sortSoldNum),t}).then(r=>{h(o,{data:r}).then(()=>{}).catch(t=>{console.error(t)})})}}});export{g as a};
