import{z as c}from"./index-ed25072b.js";import{s as a,k as l,n as h}from"./apis-cc65c95d.js";import{t as i}from"./timeFormat-77515bb4.js";import{S as u}from"./sweetalert2.all-a1700339.js";const g=c("adminOrderStore",{state:()=>({orderList:[],orderAll:[],productSoldNum:{},sortSoldNum:[],pagination:{},isLoading:!1}),actions:{showToast(r){u.mixin({toast:!0,position:"top",showConfirmButton:!1,timer:2500,timerProgressBar:!0,...r}).fire()},getOrder(r=1){this.isLoading=!0,a(r).then(o=>{this.orderList=o.data.orders,this.pagination=o.data.pagination,i(this.orderList),this.isLoading=!1,this.orderList.forEach(t=>{t.total=Math.round(t.total),i(t,"create_at")})})},async getOrderAll(){let r={...this.pagination};this.orderAll=[];let o=r.current_page;for(r.has_next||await a(o).then(t=>{const s=t.data.orders;this.orderAll.push(...s)}).catch(t=>console.error(t));r.has_next;)await a(o).then(t=>{r=t.data.pagination,o++;const s=t.data.orders;this.orderAll.push(...s)}).catch(t=>console.error(t))},async calcOrderNum(){await this.getOrderAll();const r=this.orderAll.map(t=>Object.keys(t.products));let o=[];r.forEach((t,s)=>{t.forEach(e=>{o.push(this.orderAll[s].products[e])})}),this.productSoldNum=[],o.forEach(t=>{if(this.productSoldNum[t.id])this.productSoldNum[t.id].qty+=t.qty;else{const{id:s,qty:e,product:d}=t,n={id:s,qty:e,product:d};this.productSoldNum[t.id]=n}}),this.sortSoldNum=Object.values(this.productSoldNum).sort((t,s)=>s.qty-t.qty),this.sortSoldNum.length>10&&(this.sortSoldNum=this.sortSoldNum.slice(0,10))},async sendRankInfo(){const r="-NrQ8wc--1weD4FTHjHH";l(r).then(o=>{this.calcOrderNum();const t=o.data.article;return t.content=JSON.stringify(this.sortSoldNum),t}).then(o=>{h(r,{data:o}).then(t=>{this.showToast({title:"已更新排行榜",icon:"success"})}).catch(t=>{console.error(t)})})}}});export{g as a};
